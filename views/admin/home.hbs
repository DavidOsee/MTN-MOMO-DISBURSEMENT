

<header id="header" class="header fixed-top d-flex align-items-center">

		<div class="d-flex align-items-center justify-content-between">
		<a href="/admin/home" class="logo d-flex align-items-center">
			{{!-- <img src="assets/img/logo.png" alt=""> --}}
			<span class="d-none d-lg-block">Admin Area</span>
		</a>
		<i class="bi bi-list toggle-sidebar-btn"></i>
		</div><!-- End Logo -->

		{{!-- <div class="search-bar">
		<form class="search-form d-flex align-items-center" method="POST" action="#">
			<input type="text" name="query" placeholder="Search" title="Enter search keyword">
			<button type="submit" title="Search"><i class="bi bi-search"></i></button>
		</form>
		</div> --}}

		<nav class="header-nav ms-auto">
		<ul class="d-flex align-items-center">

			{{!-- <li class="nav-item d-block d-lg-none">
			<a class="nav-link nav-icon search-bar-toggle " href="#">
				<i class="bi bi-search"></i>
			</a>
			</li>  --}}
			

			<li class="nav-item dropdown pe-3">

			<a class="nav-link nav-profile d-flex align-items-center pe-0" href="#" data-bs-toggle="dropdown">
				<img src="https://eu.ui-avatars.com/api/?name={{fn}}+{{ln}}&size=250" alt="Profile" class="rounded-circle" />
				<span class="d-none d-md-block dropdown-toggle ps-2">
					<b id="lname">{{ln}}</b>
					<span>{{fn}}</span>
				</span>
			</a><!-- End Profile Iamge Icon -->

			<ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow profile">
				<li class="dropdown-header">
				<h6>{{ln}} {{fn}}</h6>
				<span>{{role}} Admin</span>
				</li>
				<li>
				<hr class="dropdown-divider">
				</li>

				<li>
				<a class="dropdown-item d-flex align-items-center" href="/admin/profile">
					<i class="bi bi-person"></i>
					<span>My Profile</span>
				</a>
				</li>
				<li>
				<hr class="dropdown-divider">
				</li>

				<li>
				<a class="dropdown-item d-flex align-items-center" href="#" id="logout">
					<i class="bi bi-box-arrow-right"></i>
					<span>Log Out</span>
				</a>
				</li>

			</ul><!-- End Profile Dropdown Items -->
			</li><!-- End Profile Nav -->

		</ul>
		</nav><!-- End Icons Navigation -->

</header>

<aside id="sidebar" class="sidebar">

	<ul class="sidebar-nav" id="sidebar-nav">

	<li class="nav-item">
		<a class="nav-link " href="/admin/home">
		<i class="bi bi-grid"></i>
		<span>Dashboard</span>
		</a>
	</li><!-- End Dashboard Nav -->

	<li class="nav-item">
		<a class="nav-link collapsed" data-bs-target="#components-nav" data-bs-toggle="collapse" href="#">
		<i class="bi bi-person"></i><span>Admin</span><i class="bi bi-chevron-down ms-auto"></i>
		</a>
		<ul id="components-nav" class="nav-content collapse " data-bs-parent="#sidebar-nav">
		<li>
			<a href="/admin/register">
			<i class="bi bi-circle"></i><span>Register</span>
			</a>
		</li>
		<li>
			<a href="/admin/users">
			<i class="bi bi-circle"></i><span>Admin users</span>
			</a>
		</li>
		</ul>
	</li><!-- End Components Nav -->

	<li class="nav-item">
		<a class="nav-link collapsed" target="_blank" href="#">
		<i class="bi bi-journal-text"></i><span>Survey</span>
		</a>
	</li>
	<li class="nav-item">
		<a class="nav-link collapsed" target="_blank" href="https://docs.google.com/spreadsheets/d/1BuVa8qmUnAyEIZPCncrAieG3V49Wy9TW3ub0DOSOazI/edit?resourcekey#gid=416479247">
		<i class="bi bi-file-earmark-excel"></i><span>Excel file</span>
		</a>
	</li>
	<!-- End Forms Nav -->

	</ul>

</aside>


<main id="main" class="main">

    <div class="pagetitle">
      <h1>Data Tables</h1>
      <nav>
        <ol class="breadcrumb">
          <li class="breadcrumb-item">Home</li>
          <li class="breadcrumb-item">Tables</li>
        </ol>
      </nav>
    </div><!-- End Page Title -->

    <section class="section">
      <div class="row">
        <div class="col-lg-12">

          <div class="card p-4">
            <div class="card-body">

				{{!-- GRABBING ROLE --}}
				<input type="hidden" id="role" value="{{role}}" />

				{{!-- SET TRANSACTION FRONT-END DISBURSEMENT AMOUNT --}}
				<div class="ui blue big label">
					TRANSACTION FEE  - 
					<div class="detail"><span id="fee">{{ls_amount}}</span> <span>FCFA</span></div>
				</div>
				<form id="transFeeForm" method="post" action="/transfee" class="mt-5  pb-4">
					<div class="ui fluid action input">
						<input name="transFee" type="text" placeholder="Edit transation amount" />
						<button id="submitBtn" type="submit" class="ui primary button">Submit</button>
						<button id="submitLoading" class="ui primary loading button d-none">Loading</button>
					</div>
            	</form>

              <h5 class="card-title">Disbursement transactions</h5>
              {{!-- <p>Table listing all the transaction proceeded from the Front-End.</p> --}}
 
			  
              {{!-- <p class="fs-4 float-start"> Total - <b>10.000</b> FCFA</p> --}}
            </div>
            {{!-- class="table datatable datatable-table" --}}
            <div class="datatable-container table-responsive">
              <table  id="transaction_table" class="table table-striped">
                <thead>
                  <tr>
                    <td>No.</td>
                    <td>NAME</td>
                    <td>NUMBER</td>
                    <td>AMOUNT</td>
                    <td>TRANSACTION ID</td>
                    <td>DATE &amp; TIME</td>
                    <td>STATUS</td>
                  </tr>
                </thead>
                <tbody>
				{{#each trans_obj}}
                  <tr>
                    <td>{{id}}</td>
                    <td>{{name}}</td>
                    <td>{{number}}</td>
                    <td class="amount">{{amount}}</td>
                    <td class="trans_id">{{trans_id}}</td>
                    <td class="date">{{createdAt}}</td>
                    <td class="status">{{this.status }}</td>
                  </tr>
                {{/each}}
                </tbody>
              </table>
            </div>
              <!-- End Table with stripped rows -->

			  <div class="ui grey big label mt-3 mb-2">
					TOTAL - 
					<div class="detail"><span id="total"></span> <span>FCFA</span></div>
			  </div>

          </div>
        </div>

      </div>
    {{!-- </div> --}}

    </section>

  </main>


  <script>
	$(document).ready(function() {

		//LOAD FEE IN INPUT 
		$('[name=transFee]').val($('#fee').text())

		//Submit Trans fee 
		$('#transFeeForm').on('submit', (e)=>
		{
			e.preventDefault()

			//Grab form value
			let transFee = $('[name=transFee]').val().toString()

			//PREVENTING ROLE 
			if($('#role').val() != "Main")
			{
				$.toast({
					heading: 'Warning',
					text: 'You are not allowed to make any changes',
					position: 'top-right',
					icon: 'warning',
					hideAfter: 7000,
					loader: true, 
					stack: false
				})
			}
			else
			{
				//Empty FORM
				if(transFee == "" || transFee.length > 6 || parseInt(transFee)!=transFee )
				{ //999,999 limit
					$.toast({
						heading: 'Error',
						text: 'Please enter a valid amount',
						position: 'top-right',
						icon: 'error',
						hideAfter: 4000,
						loader: true, 
						stack: false
					})
				}

				 //Send to the server for further troubleshooting 
				$.ajax({
					type: 'POST',
					url: 'transfee',
					data: { 
						fee : transFee
					},
					success: function(res)
					{
						console.log(res)
						//return false
						if(res == 'error')
						{
							$.toast({
								heading: 'Warning',
								text: 'Something went wrong, Please try again',
								position: 'top-right',
								icon: 'warning',
								hideAfter: 7000,
								loader: true, 
								stack: false
							})
						}else
						{
							//Update Transaction FEE h1
							$('#fee').text(res) //res = updated transFee

							//Btn swap 
							$('#submitBtn').addClass('d-none')
							$('#submitLoading').removeClass('d-none')

							//Delay then update 
                        	setTimeout(function()
							{
                            //
								$.toast({
								heading: 'Success',
								text: 'Transaction fee updated',
								position: 'top-right',
								icon: 'success',
								hideAfter: 5000,
								loader: true, 
								stack: false
								})

								//Btn swap 
								$('#submitBtn').removeClass('d-none')
								$('#submitLoading').addClass('d-none')
                           
                            
                       		}, 2000)
							
						}   
					}, error: function(e){
						console.log(e)
					}
				})//End Ajax

			}

		})//End TransFeeForm 



		//Status Text color
		$('.status').each(function(index, obj)
		{

			if($(this).text() == "SUCCESSFUL")
				$(this).addClass('text-success')

			if($(this).text() == "UNSUCCESSFUL")
				$(this).addClass('text-danger')

			if($(this).text() == "PENDING")
				$(this).addClass('text-info')
		})

		//Totla Transaction amount 
		let total = 0

		$('.amount').each(function(index, obj)
		{
			total += parseInt($(this).text()) 
		})
		//Append in DOM
		$('#total').text(total.toLocaleString("en"))  


		//Date formating 
		$('.date').each(function(index, obj)
		{
			$(this).text(($.format.date($(this).text(), "dd/MM/yyyy HH:mm:ss")))
		})


		//Date formating 
		$('.trans_id').each(function(index, obj)
		{
			$(this).text($(this).text().slice(0,23))
		})
	

	})
  </script>